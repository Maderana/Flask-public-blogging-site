{% extends 'base.html' %}
{% block content %}
<article>
  <h1 class="post-title">{{ post.title | markdown_title }}</h1>
  <p class="meta">By {{ post.author.username }} on {{ post.timestamp.strftime('%Y-%m-%d %H:%M') }}</p>
  <div class="post-content">
    {{ post.content | markdown_to_html }}
  </div>
</article>

<section id="comments">
  <h3>Comments ({{ comments|length }})</h3>
  {% for c in comments %}
    <div class="comment">
      <p><strong>{{ c.author.username if c.author else 'Anonymous' }}</strong> on {{ c.timestamp.strftime('%Y-%m-%d %H:%M') }}</p>
      <div class="comment-content">
        {{ c.content | markdown_to_html }}
      </div>
    </div>
  {% endfor %}
</section>

{% if current_user.is_authenticated %}
  <form method="post" action="{{ url_for('main.post_detail', post_id=post.id) }}">
    {{ csrf_field|default('') }} <!-- If you use Flask-WTF, render a comment form and include form.hidden_tag() -->
    <textarea name="content" required></textarea>
    <button type="submit">Add comment</button>
  </form>
{% else %}
  <p><a href="{{ url_for('auth.login') }}">Log in</a> to add a comment.</p>
{% endif %}
{% endblock %}